# Generated by Django 5.2 on 2025-12-17 13:58

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('workspace', '0006_customerprofile_customernotification_investorprofile_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='AIConversation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('conversation_type', models.CharField(choices=[('INITIAL_CONTACT', 'Initial Contact'), ('APPOINTMENT_SCHEDULING', 'Appointment Scheduling'), ('FOLLOW_UP', 'Follow Up'), ('QUALIFICATION', 'Lead Qualification')], max_length=30)),
                ('status', models.CharField(choices=[('INITIATED', 'Initiated'), ('IN_PROGRESS', 'In Progress'), ('COMPLETED', 'Completed'), ('FAILED', 'Failed')], default='INITIATED', max_length=20)),
                ('phone_number', models.CharField(max_length=20)),
                ('preferred_method', models.CharField(max_length=10)),
                ('conversation_transcript', models.TextField(blank=True, null=True)),
                ('ai_responses', models.JSONField(blank=True, default=list)),
                ('customer_responses', models.JSONField(blank=True, default=list)),
                ('appointment_scheduled', models.BooleanField(default=False)),
                ('scheduled_datetime', models.DateTimeField(blank=True, null=True)),
                ('customer_qualified', models.BooleanField(default=False)),
                ('qualification_score', models.IntegerField(blank=True, null=True)),
                ('call_sid', models.CharField(blank=True, max_length=100, null=True)),
                ('recording_url', models.URLField(blank=True, null=True)),
                ('duration_seconds', models.IntegerField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
            ],
            options={
                'db_table': 'ai_conversations',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='AngiConnection',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('access_token', models.TextField()),
                ('refresh_token', models.TextField(blank=True, null=True)),
                ('token_expires_at', models.DateTimeField()),
                ('angi_account_id', models.CharField(max_length=100)),
                ('is_active', models.BooleanField(default=True)),
                ('last_sync', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='angi_connection', to=settings.AUTH_USER_MODEL)),
                ('workspace', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='angi_connections', to='workspace.workspace')),
            ],
            options={
                'db_table': 'angi_connections',
            },
        ),
        migrations.CreateModel(
            name='InsuranceVerification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('insurance_company', models.CharField(max_length=255)),
                ('policy_number', models.CharField(max_length=100)),
                ('coverage_amount', models.DecimalField(decimal_places=2, max_digits=15)),
                ('effective_date', models.DateField()),
                ('expiry_date', models.DateField()),
                ('status', models.CharField(choices=[('PENDING', 'Pending Verification'), ('ACTIVE', 'Active & Valid'), ('EXPIRED', 'Expired'), ('INVALID', 'Invalid'), ('CO_INSURED_MISSING', 'Apex Not Co-Insured')], default='PENDING', max_length=30)),
                ('apex_co_insured', models.BooleanField(default=False)),
                ('document_path', models.CharField(max_length=500)),
                ('document_parsed_data', models.JSONField(blank=True, default=dict)),
                ('last_verified', models.DateTimeField(blank=True, null=True)),
                ('verification_notes', models.TextField(blank=True, null=True)),
                ('auto_flagged', models.BooleanField(default=False)),
                ('flag_reason', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('contractor', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='insurance_verification', to='workspace.contractor')),
                ('verified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'insurance_verifications',
            },
        ),
        migrations.CreateModel(
            name='Lead',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('lead_number', models.CharField(db_index=True, max_length=50, unique=True)),
                ('source', models.CharField(choices=[('ANGI', 'Angi'), ('MANUAL', 'Manual Entry'), ('WEBSITE', 'Website'), ('REFERRAL', 'Referral'), ('OTHER', 'Other')], max_length=20)),
                ('status', models.CharField(choices=[('NEW', 'New'), ('CONTACTED', 'Contacted'), ('QUALIFIED', 'Qualified'), ('APPOINTMENT_SCHEDULED', 'Appointment Scheduled'), ('CONVERTED', 'Converted to Job'), ('LOST', 'Lost')], default='NEW', max_length=30)),
                ('customer_name', models.CharField(max_length=255)),
                ('customer_phone', models.CharField(max_length=20)),
                ('customer_email', models.EmailField(blank=True, max_length=254, null=True)),
                ('service_type', models.CharField(max_length=255)),
                ('location', models.TextField()),
                ('description', models.TextField()),
                ('angi_lead_id', models.CharField(blank=True, max_length=100, null=True)),
                ('ai_contacted', models.BooleanField(default=False)),
                ('ai_contact_preference', models.CharField(blank=True, max_length=20, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('angi_connection', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='workspace.angiconnection')),
                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_leads', to=settings.AUTH_USER_MODEL)),
                ('converted_job', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='source_lead', to='workspace.job')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('workspace', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='leads', to='workspace.workspace')),
            ],
            options={
                'db_table': 'leads',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='CommunicationLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('message_type', models.CharField(choices=[('SMS_OUTBOUND', 'SMS Outbound'), ('SMS_INBOUND', 'SMS Inbound'), ('VOICE_OUTBOUND', 'Voice Outbound'), ('VOICE_INBOUND', 'Voice Inbound')], max_length=20)),
                ('status', models.CharField(choices=[('QUEUED', 'Queued'), ('SENT', 'Sent'), ('DELIVERED', 'Delivered'), ('FAILED', 'Failed'), ('RECEIVED', 'Received')], max_length=20)),
                ('from_number', models.CharField(max_length=20)),
                ('to_number', models.CharField(max_length=20)),
                ('message_body', models.TextField(blank=True, null=True)),
                ('twilio_sid', models.CharField(blank=True, max_length=100, null=True)),
                ('recording_url', models.URLField(blank=True, null=True)),
                ('duration_seconds', models.IntegerField(blank=True, null=True)),
                ('cost', models.DecimalField(blank=True, decimal_places=4, max_digits=8, null=True)),
                ('error_message', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('ai_conversation', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='communications', to='workspace.aiconversation')),
                ('workspace', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='communication_logs', to='workspace.workspace')),
                ('lead', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='communications', to='workspace.lead')),
            ],
            options={
                'db_table': 'communication_logs',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='aiconversation',
            name='lead',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ai_conversations', to='workspace.lead'),
        ),
        migrations.CreateModel(
            name='LeadActivity',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('activity_type', models.CharField(choices=[('AI_TEXT_SENT', 'AI Text Sent'), ('AI_CALL_MADE', 'AI Call Made'), ('APPOINTMENT_SCHEDULED', 'Appointment Scheduled'), ('STATUS_CHANGED', 'Status Changed'), ('NOTE_ADDED', 'Note Added'), ('EMAIL_SENT', 'Email Sent')], max_length=30)),
                ('description', models.TextField()),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('lead', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='activities', to='workspace.lead')),
                ('performed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'lead_activities',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='MaterialReference',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('item_name', models.CharField(max_length=255)),
                ('quantity', models.IntegerField()),
                ('supplier', models.CharField(max_length=255)),
                ('supplier_logo', models.URLField(blank=True, null=True)),
                ('sku', models.CharField(blank=True, max_length=100, null=True)),
                ('price_low', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('price_high', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('purchase_url', models.URLField(help_text='Direct link to vendor checkout page')),
                ('description', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('job', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='material_references', to='workspace.job')),
            ],
            options={
                'db_table': 'material_references',
                'ordering': ['item_name'],
            },
        ),
        migrations.CreateModel(
            name='PriceIntelligence',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('material_name', models.CharField(db_index=True, max_length=255)),
                ('sku', models.CharField(blank=True, max_length=100, null=True)),
                ('supplier', models.CharField(choices=[('HOME_DEPOT', 'Home Depot'), ('LOWES', "Lowe's"), ('SHERWIN_WILLIAMS', 'Sherwin Williams'), ('MENARDS', 'Menards'), ('AMAZON', 'Amazon'), ('OTHER', 'Other')], max_length=20)),
                ('category', models.CharField(blank=True, max_length=100, null=True)),
                ('current_price', models.DecimalField(decimal_places=2, max_digits=10)),
                ('previous_price', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('price_per_unit', models.CharField(blank=True, max_length=50, null=True)),
                ('brand', models.CharField(blank=True, max_length=100, null=True)),
                ('description', models.TextField(blank=True, null=True)),
                ('product_url', models.URLField()),
                ('image_url', models.URLField(blank=True, null=True)),
                ('in_stock', models.BooleanField(default=True)),
                ('stock_level', models.CharField(blank=True, max_length=50, null=True)),
                ('last_scraped', models.DateTimeField(auto_now=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
            options={
                'db_table': 'price_intelligence',
                'indexes': [models.Index(fields=['material_name', 'supplier'], name='price_intel_materia_1a9248_idx'), models.Index(fields=['last_scraped'], name='price_intel_last_sc_267df2_idx')],
                'unique_together': {('material_name', 'sku', 'supplier')},
            },
        ),
        migrations.CreateModel(
            name='TwilioIntegration',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('account_sid', models.CharField(max_length=100)),
                ('auth_token', models.CharField(max_length=100)),
                ('phone_number', models.CharField(max_length=20)),
                ('sms_enabled', models.BooleanField(default=True)),
                ('voice_enabled', models.BooleanField(default=True)),
                ('recording_enabled', models.BooleanField(default=False)),
                ('sms_webhook_url', models.URLField(blank=True, null=True)),
                ('voice_webhook_url', models.URLField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('workspace', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='twilio_integration', to='workspace.workspace')),
            ],
            options={
                'db_table': 'twilio_integrations',
            },
        ),
        migrations.DeleteModel(
            name='MaterialDelivery',
        ),
        migrations.AddIndex(
            model_name='lead',
            index=models.Index(fields=['workspace', 'status'], name='leads_workspa_7a07cd_idx'),
        ),
        migrations.AddIndex(
            model_name='lead',
            index=models.Index(fields=['source', 'created_at'], name='leads_source_508ec9_idx'),
        ),
    ]
